<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Blog{% endblock %}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <!-- Firebase SDK v12 (ESM) con llaves provistas -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
    // Config por defecto (válida) del proyecto. Los valores del entorno SOLO sobrescriben si son truthy.
    const defaults = {
      apiKey: "AIzaSyDFiuc4X6_uIQq2DzbaKxrxQ-7sIzSX7s4",
      authDomain: "chatdistribuido-6d4ed.firebaseapp.com",
      projectId: "chatdistribuido-6d4ed",
      storageBucket: "chatdistribuido-6d4ed.firebasestorage.app",
      messagingSenderId: "906064184156",
      appId: "1:906064184156:web:100eaa405c262b97417799",
      measurementId: "G-V0Z5L0PVB5"
    };
    const envCfg = {{ firebase_config|tojson|safe }};
    const firebaseConfig = { ...defaults };
    if (envCfg && typeof envCfg === 'object') {
      for (const [k, v] of Object.entries(envCfg)) {
        if (v) firebaseConfig[k] = v; // evita sobreescribir con strings vacíos
      }
    }
    window.__FIREBASE_CONFIG__ = firebaseConfig;
    try {
      const app = initializeApp(firebaseConfig);
      try { getAnalytics(app); } catch (_) { /* analytics opcional */ }
      window.__FIREBASE_APP_READY__ = true;
    } catch (e) {
      console.error('Error inicializando Firebase', e);
      window.__FIREBASE_APP_READY__ = false;
      window.__FIREBASE_INIT_ERROR__ = String(e && e.message || e);
    }
  </script>
  <script type="module" src="{{ url_for('static', filename='auth.js') }}"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-left"><a href="{{ url_for('index') }}" class="brand">MiniBlog</a></div>
    <div class="nav-right">
      <form method="get" action="{{ url_for('index') }}" class="search-form">
        <input type="text" name="q" placeholder="Buscar..." value="{{ q or '' }}" />
      </form>
      <div id="user-links">
        <a href="{{ url_for('login') }}">Entrar</a>
      </div>
    </div>
  </nav>
  <main class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for cat,msg in messages %}
            <li class="flash {{ cat }}">{{ msg }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>
  <footer class="footer">&copy; {{ now.year }} MiniBlog</footer>
</body>
</html>